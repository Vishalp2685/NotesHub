<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Explore Notes | NotesHub</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='explore.css') }}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
    <script>
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js';
</script>
</head>
<body>
    {% include 'nav.html' %}
    <style>
        .nav-right {
            margin-right: 80px;
        }
    </style>
    <div class="explore-main-container">
        <aside class="explore-sidebar">
            <form class="explore-filters" method="GET">
                <div class="filter-title">Filters</div>
                <div class="filter-group">
                    <label for="year">Year</label>
                    <select id="year" name="year">
                        <option value="">All</option>
                        <option value="2025">2025</option>
                        <option value="2024">2024</option>
                        <option value="2023">2023</option>
                        <option value="2022">2022</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="branch">Branch</label>
                    <select id="branch" name="branch">
                        <option value="">All</option>
                        <option value="CSE">CSE</option>
                        <option value="IT">IT</option>
                        <option value="ECE">ECE</option>
                        <option value="EEE">EEE</option>
                        <option value="ME">ME</option>
                        <option value="CE">CE</option>
                        <option value="CHE">CHE</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="sem">Semester</label>
                    <select id="sem" name="sem">
                        <option value="">All</option>
                        {% for i in range(1, 9) %}
                        <option value="{{ i }}">{{ i }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="filter-group">
                    <label for="subject">Subject</label>
                    <input type="text" id="subject" name="subject" placeholder="e.g. Data Structures">
                </div>
                <!-- <div class="filter-group">
                    <label for="uploaded_by">Uploaded By</label>
                    <input type="text" id="uploaded_by" name="uploaded_by" placeholder="e.g. John Doe">
                </div> -->
                <button class="filter-btn" type="submit">Apply</button>
            </form>
        </aside>
        <main class="explore-content">
            <div class="explore-header-bar">
                <form class="explore-searchbar" method="GET">
                    <input type="text" name="q" placeholder="Search notes, subjects, or papers‚Ä¶" value="{{ request.args.get('q', '') }}">
                    <button type="submit" class="search-btn">üîç</button>
                </form>
                <!-- <div class="explore-actions">
                    <button class="toggle-btn active" id="gridViewBtn" title="Grid view" aria-label="Grid view"><svg width="20" height="20" fill="none"><rect x="2" y="2" width="6" height="6" rx="2" fill="#6c63ff"/><rect x="12" y="2" width="6" height="6" rx="2" fill="#6c63ff"/><rect x="2" y="12" width="6" height="6" rx="2" fill="#6c63ff"/><rect x="12" y="12" width="6" height="6" rx="2" fill="#6c63ff"/></svg></button>
                    <button class="toggle-btn" id="listViewBtn" title="List view" aria-label="List view"><svg width="20" height="20" fill="none"><rect x="3" y="4" width="14" height="3" rx="1.5" fill="#b2b2c3"/><rect x="3" y="9" width="14" height="3" rx="1.5" fill="#b2b2c3"/><rect x="3" y="14" width="14" height="3" rx="1.5" fill="#b2b2c3"/></svg></button>
                    <button class="toggle-btn" id="darkModeBtn" title="Toggle dark mode" aria-label="Toggle dark mode"><svg width="20" height="20" fill="none"><circle cx="10" cy="10" r="8" fill="#e0e6ed"/><path d="M10 2a8 8 0 1 0 8 8c0-4.418-3.582-8-8-8z" fill="#6c63ff"/></svg></button>
                </div> -->
            </div>
            <section class="explore-trending">
                <!-- <h2 class="trending-title">Trending Notes</h2> -->
                {% if notes|length == 0 %}
                <div style="text-align:center; margin: 8rem 0; display: flex; flex-direction: column; align-items: center; justify-content: center; width: 100%;">
                    <div style="font-size:3rem;">üì≠</div>
                    <h2 style="color:#40e0d0; margin:1rem 0 0.5rem 0;">No notes found</h2>
                    <p style="color:#b2b2c3; font-size:1.1rem;">Try searching for different notes or <a href="{{ url_for('upload') }}" style="color:#48cae4; text-decoration:underline; font-weight:600;">upload one</a> to help others!</p>
                    <div style="margin-top:1.2rem; font-size:1.3rem; color:#888;">"Knowledge shared is knowledge multiplied."</div>
                </div>
                {% endif %}
                <div class="cards-grid">
                    {% for note in notes %}
                    <div class="card" tabindex="0" role="button" aria-label="Download {{ note.sub_name }}" onclick="window.location.href='{{ url_for('download_any_file', filepath=note.file_path) }}'" onkeydown="if(event.key==='Enter'||event.key===' '){window.location.href='{{ url_for('download_any_file', filepath=note.file_path) }}';}">
                <div class="card-icon">üìò</div>
                <div class="card-subject">{{ note.sub_name }}</div>
                <div class="card-author" style="font-size: 10px;">{{note.description}}</div>
                <div class="card-tags">
                    <span class="tag">Branch: {{ note.branch }}</span>
                    <span class="tag">Sem: {{ note.sem }}</span>
                    <span class="tag">Year: {{ note.year }}</span>
                </div>
                <div class="card-author">üë§ Uploaded by: {{ note.uploaded_by }}</div>
                <canvas class="card-preview" id="pdf-preview-{{ loop.index }}"></canvas>
                <input type="hidden" class="pdf-path" value="{{ url_for('download_any_file', filepath=note.file_path, preview=1) }}">
            </div>
                    {% endfor %}
                </div>
            </section>
        </main>
    </div>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const previews = document.querySelectorAll(".card-preview");
            const paths = document.querySelectorAll(".pdf-path");

            previews.forEach((canvas, index) => {
                const url = paths[index].value;
                const context = canvas.getContext('2d');

                pdfjsLib.getDocument(url).promise.then(pdf => {
                    pdf.getPage(1).then(page => {
                        const scale = 1.2;
                        const viewport = page.getViewport({ scale });
                        canvas.width = viewport.width;
                        canvas.height = viewport.height;

                        const renderContext = {
                            canvasContext: context,
                            viewport: viewport
                        };
                        page.render(renderContext);
                    });
                });
            });
        });

        // Grid/List toggle logic (basic, for demo)
        const gridBtn = document.getElementById('gridViewBtn');
        const listBtn = document.getElementById('listViewBtn');
        const notesGrid = document.getElementById('notesGrid');
        gridBtn.onclick = () => {
            gridBtn.classList.add('active');
            listBtn.classList.remove('active');
            notesGrid.classList.remove('list-view');
        };
        listBtn.onclick = () => {
            listBtn.classList.add('active');
            gridBtn.classList.remove('active');
            notesGrid.classList.add('list-view');
        };
        // (Optional) Dark mode toggle logic placeholder
        document.getElementById('darkModeBtn').onclick = () => {
            document.body.classList.toggle('dark-mode');
        };
    </script>
</body>

</html>